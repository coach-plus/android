name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-18.04
    
    steps:
    - uses: actions/checkout@v1
    - name: Build
      env: 
        ci_cd_secret_key: ${{ secrets.ci_cd_secret_key }}
        test: ${{ secrets.test }}
      run: |
        # apt-get install -y openssl 
        echo $test > test
        cat ./test
        openssl version
        openssl enc -aes-256-cbc -d -in secrets.tar.enc -out secrets.tar -k $ci_cd_secret_key
        tar xvf secrets.tar
        rvm install 2.1
        gem install fastlane
        echo y | android update sdk --no-ui --all --filter "tool,extra-android-m2repository,extra-android-support,extra-google-google_play_services,extra-google-m2repository"
        echo y | $ANDROID_HOME/tools/bin/sdkmanager "extras;m2repository;com;android;support;constraint;constraint-layout-solver;1.0.2"
    - name: Publish
      run: fastlane build_beta

